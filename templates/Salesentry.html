
<!DOCTYPE html>
<html>
<head>
	<!-- Basic Page Info -->
	<meta charset="utf-8">
	<title>Billing system</title>
 <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* Custom CSS for additional styling */
        body {
            margin: 20px;
        }

        table {
            width: 100%;
            margin-bottom: 1rem;
            background-color: transparent;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        th {
            background-color: #000000;
            color: #ffffff;
        }

        a {
            color: #007bff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
	<!-- Site favicon -->
	<link rel="apple-touch-icon" sizes="180x180" href="static/vendors/images/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="static/vendors/images/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="static/vendors/images/favicon-16x16.png">

	<!-- Mobile Specific Metas -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
	<!-- CSS -->
	<link rel="stylesheet" type="text/css" href="static/vendors/styles/core.css">
	<link rel="stylesheet" type="text/css" href="static/vendors/styles/icon-font.min.css">
	<link rel="stylesheet" type="text/css" href="static/src/plugins/jquery-steps/jquery.steps.css">
	<link rel="stylesheet" type="text/css" href="static/src/plugins/datatables/css/dataTables.bootstrap4.min.css">
	<link rel="stylesheet" type="text/css" href="static/src/plugins/datatables/css/responsive.bootstrap4.min.css">
	<link rel="stylesheet" type="text/css" href="static/vendors/styles/style.css">

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-119386393-1');
	</script>
</head>

<body>


	<div class="header">
		<div class="header-left">
			<div class="menu-icon dw dw-menu"></div>
			<div class="search-toggle-icon dw dw-search2" data-toggle="header_search"></div>

		</div>
		<div class="header-right">
			<div class="dashboard-setting user-notification">
				<div class="dropdown">
					<a class="dropdown-toggle no-arrow" href="javascript:;" data-toggle="right-sidebar">
						<i class="dw dw-settings2"></i>
					</a>
				</div>
			</div>

			<div class="user-info-dropdown">
				<div class="dropdown">


					<a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
						<span class="user-icon">
							<img src="<?php echo (!empty($row['location'])) ? '../uploads/'.$row['location'] : '../uploads/NO-IMAGE-AVAILABLE.jpg'; ?>" alt="">
						</span>
						<span class="user-name"><?php echo $row['FirstName']. " " .$row['LastName']; ?></span>
					</a>
					<div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
						<a class="dropdown-item" href="my_profile.php"><i class="dw dw-user1"></i> Profile</a>
						<a class="dropdown-item" href="change_password.php"><i class="dw dw-help"></i> Reset Password</a>
						<a class="dropdown-item" href="../logout.php"><i class="dw dw-logout"></i> Log Out</a>
					</div>
				</div>
			</div>

		</div>
	</div>

	<div class="right-sidebar">
		<div class="sidebar-title">
			<h3 class="weight-600 font-16 text-blue">
				Layout Settings
				<span class="btn-block font-weight-400 font-12">User Interface Settings</span>
			</h3>
			<div class="close-sidebar" data-toggle="right-sidebar-close">
				<i class="icon-copy ion-close-round"></i>
			</div>
		</div>
		<div class="right-sidebar-body customscroll">
			<div class="right-sidebar-body-content">
				<h4 class="weight-600 font-18 pb-10">Header Background</h4>
				<div class="sidebar-btn-group pb-30 mb-10">
					<a href="javascript:void(0);" class="btn btn-outline-primary header-white active">White</a>
					<a href="javascript:void(0);" class="btn btn-outline-primary header-dark">Dark</a>
				</div>

				<h4 class="weight-600 font-18 pb-10">Sidebar Background</h4>
				<div class="sidebar-btn-group pb-30 mb-10">
					<a href="javascript:void(0);" class="btn btn-outline-primary sidebar-light ">White</a>
					<a href="javascript:void(0);" class="btn btn-outline-primary sidebar-dark active">Dark</a>
				</div>

				<h4 class="weight-600 font-18 pb-10">Menu Dropdown Icon</h4>
				<div class="sidebar-radio-group pb-10 mb-10">
					<div class="custom-control custom-radio custom-control-inline">
						<input type="radio" id="sidebaricon-1" name="menu-dropdown-icon" class="custom-control-input" value="icon-style-1" checked="">
						<label class="custom-control-label" for="sidebaricon-1"><i class="fa fa-angle-down"></i></label>
					</div>
					<div class="custom-control custom-radio custom-control-inline">
						<input type="radio" id="sidebaricon-2" name="menu-dropdown-icon" class="custom-control-input" value="icon-style-2">
						<label class="custom-control-label" for="sidebaricon-2"><i class="ion-plus-round"></i></label>
					</div>
					<div class="custom-control custom-radio custom-control-inline">
						<input type="radio" id="sidebaricon-3" name="menu-dropdown-icon" class="custom-control-input" value="icon-style-3">
						<label class="custom-control-label" for="sidebaricon-3"><i class="fa fa-angle-double-right"></i></label>
					</div>
				</div>

				<h4 class="weight-600 font-18 pb-10">Menu List Icon</h4>
				<div class="sidebar-radio-group pb-30 mb-10">
					<div class="custom-control custom-radio custom-control-inline">
						<input type="radio" id="sidebariconlist-1" name="menu-list-icon" class="custom-control-input" value="icon-list-style-1" checked="">
						<label class="custom-control-label" for="sidebariconlist-1"><i class="ion-minus-round"></i></label>
					</div>
					<div class="custom-control custom-radio custom-control-inline">
						<input type="radio" id="sidebariconlist-2" name="menu-list-icon" class="custom-control-input" value="icon-list-style-2">
						<label class="custom-control-label" for="sidebariconlist-2"><i class="fa fa-circle-o" aria-hidden="true"></i></label>
					</div>
					<div class="custom-control custom-radio custom-control-inline">
						<input type="radio" id="sidebariconlist-3" name="menu-list-icon" class="custom-control-input" value="icon-list-style-3">
						<label class="custom-control-label" for="sidebariconlist-3"><i class="dw dw-check"></i></label>
					</div>
					<div class="custom-control custom-radio custom-control-inline">
						<input type="radio" id="sidebariconlist-4" name="menu-list-icon" class="custom-control-input" value="icon-list-style-4" checked="">
						<label class="custom-control-label" for="sidebariconlist-4"><i class="icon-copy dw dw-next-2"></i></label>
					</div>
					<div class="custom-control custom-radio custom-control-inline">
						<input type="radio" id="sidebariconlist-5" name="menu-list-icon" class="custom-control-input" value="icon-list-style-5">
						<label class="custom-control-label" for="sidebariconlist-5"><i class="dw dw-fast-forward-1"></i></label>
					</div>
					<div class="custom-control custom-radio custom-control-inline">
						<input type="radio" id="sidebariconlist-6" name="menu-list-icon" class="custom-control-input" value="icon-list-style-6">
						<label class="custom-control-label" for="sidebariconlist-6"><i class="dw dw-next"></i></label>
					</div>
				</div>

				<div class="reset-options pt-30 text-center">
					<button class="btn btn-danger" id="reset-settings">Reset Settings</button>
				</div>
			</div>
		</div>
	</div>

	<div class="left-side-bar">
		<div class="brand-logo">
			<a href="#">
				<h1 alt="" class="dark-logo" >e-Billing</h1>
				<h1 alt="" class="light-logo" style="color:white">e-Billing</h1>
			</a>
			<div class="close-sidebar" data-toggle="left-sidebar-close">
				<i class="ion-close-round"></i>
			</div>
		</div>
		<div class="menu-block customscroll">
			<div class="sidebar-menu">
					<ul id="accordion-menu">
					<li class="dropdown">
						<a href="/" class="dropdown-toggle no-arrow">
							<span class="micon dw dw-house-1"></span><span class="mtext">Dashboard</span>
						</a>

					</li>
				<li>
						<a href="/Companyentry" class="dropdown-toggle no-arrow">
							<span class="micon dw dw-edit-2"></span><span class="mtext">Add Company</span>
						</a>
					</li>
					<li>
						<a href="/company_data" class="dropdown-toggle no-arrow">
							<span class="micon dw dw-edit-2"></span><span class="mtext">Company details</span>
						</a>
					</li>
						<li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
							<span class="micon dw dw-library"></span><span class="mtext">Customer Entry</span>
						</a>
						<ul class="submenu">
							<li><a href="/addcustomer">Add Customer</a></li>
							<li><a href="/display_customers">Customer details</a></li>
						</ul>
					</li>
						<li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
							<span class="micon dw dw-library"></span><span class="mtext">Vendor</span>
						</a>
						<ul class="submenu">
							<li><a href="/Vendorentry">Vendor Entry</a></li>
							<li><a href="/display_vendors">Vendor details</a></li>
						</ul>
					</li>
						<li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
							<span class="micon dw dw-library"></span><span class="mtext">Item Entry</span>
						</a>
						<ul class="submenu">
							<li><a href="/additem">Add item</a></li>
							<li><a href="/display_items">Item details</a></li>
						</ul>
					</li>

					<li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
							<span class="micon dw dw-library"></span><span class="mtext">Sales</span>
						</a>
						<ul class="submenu">
							<li><a href="/Salesentry">Sales Entry</a></li>
							<li><a href="/display_sales">Sales details</a></li>
						</ul>
					</li>

					<li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
							<span class="micon dw dw-library"></span><span class="mtext">Purchase</span>
						</a>
						<ul class="submenu">
							<li><a href="/Purchaseentry">Purchase Entry</a></li>
							<li><a href="/display_purchases">Purchase details</a></li>
						</ul>
					</li>



					<li>
						<div class="dropdown-divider"></div>
					</li>
					<li>
						<div class="sidebar-small-cap">Extra</div>
					</li>
					<li>
						<a href="#" class="dropdown-toggle no-arrow">
							<span class="micon dw dw-edit-2"></span><span class="mtext">Visit Us</span>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</div>

	<div class="mobile-menu-overlay"></div>

	<div class="main-container">
 <div class="container mt-4">
    <h1>Sales Entry</h1>
<form action="/submit_sale" method="post">
<div class="row">
    <div class="col-md-4">
        <div class="form-group">
            <label for="companyName">Company Name</label>
            <input type="text" class="form-control" id="companyName" name="companyName" placeholder="Enter Company Name">
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="form-group">
            <label for="billDate">Bill Date</label>
            <input type="date" class="form-control" id="billDate" name="billDate" readonly>
        </div>
    </div>

<div class="col-md-4">
    <div class="form-group">
        <label for="customerID">Customer ID</label>
        <input list="customerList" class="form-control" id="customerID" name="customerID" onchange="getCustomerDetails()" placeholder="Type to search or select">
        <datalist id="customerList">
            {% for customer_id in customer_ids %}
                <option value="{{ customer_id }}">
            {% endfor %}
        </datalist>
    </div>
</div>


    <div class="col-md-4">
        <div class="form-group">
            <label for="customerName">Customer Name</label>
            <input type="text" class="form-control" id="customerName" name="customerName" placeholder="Enter Customer Name"readonly>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="form-group">
            <label for="customerMobile">Customer Mobile</label>
            <input type="text" class="form-control" id="customerMobile" name="customerMobile" placeholder="Enter Customer Mobile"readonly>
        </div>
    </div>

    <div class="col-md-4">
        <div class="form-group">
            <label for="customerAddress">Customer Address</label>
            <input type="text" class="form-control" id="customerAddress" name="customerAddress" placeholder="Enter Customer Address"readonly>
        </div>
    </div>

    <div class="col-md-4">
        <div class="form-group">
            <label for="customerGST">Customer GST</label>
            <input type="text" class="form-control" id="customerGST" name="customerGST" placeholder="Enter Customer GST"readonly>
        </div>
    </div>
</div>
    <table class="table table-bordered table-striped" id="itemTable">
        <thead class="thead-dark">
            <tr>
                <th>Sno</th>
                <th>Item Code</th>
                <th>Item Name</th>
                <th>Qty</th>
                <th>Price</th>
                <th>GST</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody id="itemTableBody">
            <tr>
                <td><input type="text" class="form-control sno" name="sno" value="1" readonly></td>
                <td>
                    <input list="itemCodesList" class="form-control itemCode" id="item_code" name="item_code" onchange="getItemDetails()" placeholder="Type to search or select">
                    <datalist id="itemCodesList">
                        {% for item_code in item_codes %}
                            <option value="{{ item_code }}">
                        {% endfor %}
                    </datalist>
                </td>
                <td><input type="text" class="form-control item_name" name="item_name" placeholder="Enter Item Name" readonly></td>
                <td><input type="text" class="form-control quantity" name="qty" placeholder="Enter Qty"></td>
                <td><input type="text" class="form-control price" name="price" placeholder="Enter Price" readonly></td>
                <td><input type="text" class="form-control gst" name="gst" placeholder="Enter GST" readonly></td>
                <td><input type="text" class="form-control total" name="total" placeholder="Enter Total" readonly></td>
            </tr>
        </tbody>
    </table>
	<table>
	<tr>
    <td  align="right" class="text-right">Subtotal:</td>
    <td><input type="text" class="form-control" id="subtotal" name="subtotal" placeholder="Rs." readonly></td>
</tr>
<tr>
    <td align="right" class="text-right">GST:</td>
    <td><input type="text" class="form-control" id="totalgst" name="totalgst" placeholder="Rs." readonly></td>
</tr>
<tr>
    <td  align="right" class="text-right">Grand Total:</td>
    <td width="15%"><input type="text" class="form-control" id="grandTotal" name="grandTotal" placeholder="Rs." readonly></td>
</tr>
		</table>

    <button type="submit" class="btn btn-primary">Submit</button>
	<h6>{{msg}}</h6>
</form>
<script>
    document.addEventListener('keydown', function (event) {
        // Check if the event is triggered with Ctrl key
        if (event.ctrlKey) {
            // Check if the key pressed is 'S'
            if (event.key === 's') {
                // Prevent the default action (e.g., saving the page)
                event.preventDefault();

                // Trigger the form submission
                submitForm();
            }
        }
    });

    function submitForm() {
        // Submit the form
        document.querySelector('form').submit();
    }
</script>


	 <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get the table body
        var itemTableBody = document.getElementById('itemTableBody');

        // Add an event listener for when a new row is added
        itemTableBody.addEventListener('input', function (event) {
            // Check if the input field that triggered the event is in the Sno column
            if (event.target.classList.contains('sno')) {
                // Get the current row
                var currentRow = event.target.closest('tr');

                // Update Sno for each row
                updateSno(itemTableBody);
            }
        });
    });

    function updateSno(tableBody) {
        // Get all rows in the table body
        var rows = tableBody.querySelectorAll('tr');

        // Iterate through each row and update the Sno
        rows.forEach(function (row, index) {
            // Find the Sno input field in the current row
            var snoInput = row.querySelector('.sno');

            // Update the Sno value
            snoInput.value = index + 1;
        });
    }
</script>


<script>
    function getCustomerDetails() {
        var selectedCustomerId = $('#customerID').val();

        $.ajax({
            type: 'POST',
            url: '/get_customer_details',
            data: { 'customer_id': selectedCustomerId },
            success: function(response) {
                // Update other fields with customer details
                $('#customerName').val(response.name);
                $('#customerMobile').val(response.mobile);
                $('#customerAddress').val(response.address);
                $('#customerGST').val(response.gst);
            },
            error: function(error) {
                console.error('Error fetching customer details:', error);
            }
        });
    }
</script>
	 <script>
    document.addEventListener('DOMContentLoaded', function () {
        var currentDate = new Date().toISOString().split('T')[0];
        document.getElementById('billDate').value = currentDate;
    });
</script>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        $(document).ready(function () {
            function calculateTotal() {
                var row = $(this).closest('tr');
                var quantity = parseFloat(row.find('.quantity').val()) || 0;
                var price = parseFloat(row.find('.price').val()) || 0;
                var gst = parseFloat(row.find('.gst').val()) || 0;

                var total = quantity * price;
                row.find('.total').val(total.toFixed(2));

                // Check if the total field in the last row is filled, then add a new row
                if (row.is(':last-child') && total !== 0) {
                    var newRow = row.clone();
                    newRow.find('input').val(''); // Clear input values in the new row
                    newRow.find('.sno').val(parseInt(newRow.find('.sno').val()) + 1 || 1); // Increment the serial number or set to 1 if NaN
                    $('#itemTableBody').append(newRow);
                    updateSno(); // Update Sno for all rows

                    // Call getItemDetails for the new row
                    getItemDetails.call(newRow.find('.itemCode'));
                }
            }

            // Attach the calculateTotal function to the input event of quantity, price, and GST fields
            $('#itemTableBody').on('input', '.quantity, .price, .gst', calculateTotal);

            function updateSno() {
                // Get all rows in the table body
                var rows = $('#itemTableBody').find('tr');

                // Iterate through each row and update the Sno
                rows.each(function (index) {
                    $(this).find('.sno').val(index + 1);
                });
            }

            function getItemDetails(element) {
                // Get the selected item code from the current row
                var itemCode = $(element).val();

                // Create a new FormData object and append the item code
                var formData = new FormData();
                formData.append("item_code", itemCode);

                // Make an AJAX request to fetch item details from the server
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        // Parse the JSON response
                        var itemDetails = JSON.parse(xhr.responseText);

                        // Fill the corresponding fields with item details in the current row
                        $(element).closest('tr').find('.item_name').val(itemDetails.item_name);
                        $(element).closest('tr').find('.price').val(itemDetails.price);
                        $(element).closest('tr').find('.gst').val(itemDetails.gst);
                    }
                };

                // Replace 'your_backend_endpoint' with the actual endpoint to fetch item details from the server
                xhr.open("POST", "/get_item_details", true);
                xhr.send(formData);
            }

            // Attach the getItemDetails function to the change event of the item code field
            $('#itemTableBody').on('change', '.itemCode', function () {
                getItemDetails(this);
            });
        });
    </script>

<script>
    $(document).ready(function () {
        function calculateGSTForRow(row) {
            var quantity = parseFloat(row.find('.quantity').val()) || 0;
            var price = parseFloat(row.find('.price').val()) || 0;
            var gstRate = parseFloat(row.find('.gst').val()) || 0;

            var totalBeforeGST = quantity * price;
            var gst = (totalBeforeGST * gstRate) / 100;

            return gst;
        }

        function calculateTotalGST() {
            var totalGST = 0;
            $('#itemTableBody tr').each(function () {
                totalGST += calculateGSTForRow($(this));
            });
            return totalGST;
        }

        function calculateSubtotal() {
            var subtotal = 0;
            $('#itemTableBody tr').each(function () {
                var total = parseFloat($(this).find('.total').val()) || 0;
                subtotal += total;
            });
            return subtotal;
        }

        function calculateGrandTotal() {
            var totalGST = calculateTotalGST();
            var subtotal = calculateSubtotal();

            var grandTotal = subtotal + totalGST;
            $('#totalGST').val(totalGST.toFixed(2));
            $('#subtotal').val(subtotal.toFixed(2));
            $('#grandTotal').val(grandTotal.toFixed(2));
            var gst = grandTotal - subtotal;
            $('#totalgst').val(gst.toFixed(2));
        }

        $('#itemTableBody').on('input', '.quantity, .price', function () {
            calculateGSTForRow($(this).closest('tr'));
            calculateGrandTotal();
        });
    });
</script>



  </div>


			<div class="row pb-10">
				<div class="col-xl-3 col-lg-3 col-md-6 mb-20">
					<div class="card-box height-100-p widget-style3">



			</div>


			</div>


		</div>
	</div>
	<!-- js -->

	<script src="static/vendors/scripts/core.js"></script>
	<script src="static/vendors/scripts/script.min.js"></script>
	<script src="static/vendors/scripts/process.js"></script>
	<script src="static/vendors/scripts/layout-settings.js"></script>
	<script src="static/src/plugins/apexcharts/apexcharts.min.js"></script>
	<script src="static/src/plugins/datatables/js/jquery.dataTables.min.js"></script>
	<script src="static/src/plugins/datatables/js/dataTables.bootstrap4.min.js"></script>
	<script src="static/src/plugins/datatables/js/dataTables.responsive.min.js"></script>
	<script src="static/src/plugins/datatables/js/responsive.bootstrap4.min.js"></script>
	<script src="static/vendors/scripts/datagraph.js"></script>

	<!-- buttons for Export datatable -->
	<script src="static/src/plugins/datatables/js/dataTables.buttons.min.js"></script>
	<script src="static/src/plugins/datatables/js/buttons.bootstrap4.min.js"></script>
	<script src="static/src/plugins/datatables/js/buttons.print.min.js"></script>
	<script src="static/src/plugins/datatables/js/buttons.html5.min.js"></script>
	<script src="static/src/plugins/datatables/js/buttons.flash.min.js"></script>
	<script src="static/src/plugins/datatables/js/pdfmake.min.js"></script>
	<script src="static/src/plugins/datatables/js/vfs_fonts.js"></script>

	<script src="static/vendors/scripts/advanced-components.js"></script>
</body>
</html>